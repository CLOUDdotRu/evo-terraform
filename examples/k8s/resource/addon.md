---
page_title: "cloudru_k8s_addon Resource - cloudru"
subcategory: "k8s"
description: "Управление плагинами в кластере Kubernetes"
  
---

# Управление плагинами cloudru_k8s_addon (Resource)

В разделе рассмотрены примеры управления плагинами в кластере, а также приведено описание всех полей ресурса cloudru_k8s_addon.

## Примеры использования

Примеры описывают установку плагина в кластер и настройку конфигурации плагина.

### Установка плагина в кластер

```terraform
resource "cloudru_k8s_addon" "istio" {

  # NOTE: Обязательный параметр.
  # Идентификатор кластера.
  cluster_id = "00000000000000000000000000"

  # NOTE: Обязательный параметр.
  # Название плагина.
  name = "istio"

  # NOTE: Обязательный параметр.
  # Версия плагина в формате SemVer.
  version = "1.18.0"

  # NOTE: Обязательный параметр.
  # Режим разрешения конфликтов.
  # Должен быть один из: RESOLVE_CONFLICTS_MODE_NONE, RESOLVE_CONFLICTS_MODE_OVERWRITE
  resolve_conflicts_mode = "RESOLVE_CONFLICTS_MODE_OVERWRITE"

  # NOTE: Опциональный параметр.
  # Если флаг установлен, то при вызове удаления сервис не будет управлять плагином,
  # но плагин не будет удален из кластера.
  preserve = false
}
```

> **NOTE**: Некоторые плагины автоматически устанавливаются в кластер. Чтобы получить список уже установленных плагинов, используйте источник данных `cloudru_k8_addons`. Доступные к установке плагины можно получить через источники данных `cloudru_k8s_available_addons` и `cloudru_k8s_addon_releases`.

## Настройка конфигурации плагина

```terraform
resource "cloudru_k8s_addon" "istio" {

  cluster_id = cloudru_k8s_cluster.example-cluster.id

  name = "istio"

  version = "1.18.0"

  resolve_conflicts_mode = "RESOLVE_CONFLICTS_MODE_OVERWRITE"

  preserve = false

  # NOTE: это опциональный параметр
  # Пользовательская конфигурация плагина в JSON-формате.
  configuration = " {\"commonLabels\": {\"applied-by\": \"terraform\"}}"

  # NOTE: Это опциональный параметр
  timeouts = {
    # NOTE: Опциональный параметр.
    # Ограничение по времени создания объекта.
    # Если объект не успел создаться за указанное время, то вернется ошибка, при этом автоматического удаления не последует.
    create = "8m"

    # NOTE: Опциональный параметр.
    # Ограничение по времени получения объекта.
    read = "15s"

    # NOTE: Опциональный параметр.
    # Ограничение по времени редактирования объекта.
    update = "30m"

    # NOTE: Опциональный параметр.
    # Ограничение по времени удаления объекта.
    delete = "5m"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `cluster_id` (String) Идентификатор кластера.
- `name` (String) Название плагина, например cilium.
- `resolve_conflicts_mode` (String) Режим разрешения конфликтов. Возможные значения: `RESOLVE_CONFLICTS_MODE_OVERWRITE` `RESOLVE_CONFLICTS_MODE_PRESERVE` `RESOLVE_CONFLICTS_MODE_UNSPECIFIED` `RESOLVE_CONFLICTS_MODE_NONE`.
- `version` (String) Версия плагина в формате SemVer.

### Optional

- `configuration` (String) Пользовательская конфигурация плагина в JSON-формате согласно схеме. Поддерживает переменные автоподстановки, заключенные в символы {{ и }}: **{{clusterID}}** — уникальный идентификатор кластера; **{{clusterName}}** — программное имя кластера; **{{projectID}}** — идентификатор проекта **{{nodeCIDR}}** — CIDR сети узлов **{{serviceCIDR}}** — CIDR сервисной сети.
- `preserve` (Boolean) Используется только во время удаления плагина. Если флаг установлен, то сервис не будет управлять плагином, но плагин не будет удален из кластера.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))

### Read-Only

- `action_history` (Attributes List) История изменений плагина. Отсортировано от самого нового к самому старому. (see [below for nested schema](#nestedatt--action_history))
- `added_at` (String) Дата и время добавления плагина в кластер.
- `added_by` (String) Идентификатор пользователя, который добавил плагин в кластер.
- `id` (String) Идентификатор плагина.
- `status` (String) Статус плагина в кластере. Возможные значения: `ADDON_ACTION_STATUS_UNSPECIFIED` `ADDON_ACTION_STATUS_IN_PROGRESS` `ADDON_ACTION_STATUS_COMPLETED` `ADDON_ACTION_STATUS_FAILED` `ADDON_ACTION_STATUS_PENDING`.
- `updated_at` (String) Дата и время последнего изменения плагина.

<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) По умолчанию 40m0s.
- `delete` (String) По умолчанию 30m0s.
- `read` (String) По умолчанию 15s.
- `update` (String) По умолчанию 30m0s.


<a id="nestedatt--action_history"></a>
### Nested Schema for `action_history`

Read-Only:

- `addon_configuration` (String) Пользовательская конфигурация плагина.
- `created_at` (String) Дата и время действия.
- `created_by` (String) Идентификатор пользователя, который инициировал действие над плагином.
- `issues` (Attributes List) Список проблем, возникших при выполнении действия. (see [below for nested schema](#nestedatt--action_history--issues))
- `namespace` (String) Пространство имен, в пределах которого выполняется действие над плагином.
- `params` (Attributes List) Список параметров, используемых при выполнении действия над плагином. (see [below for nested schema](#nestedatt--action_history--params))
- `status` (String) Статус действия, может быть одним из: `ADDON_ACTION_STATUS_UNSPECIFIED` `ADDON_ACTION_STATUS_IN_PROGRESS` `ADDON_ACTION_STATUS_COMPLETED` `ADDON_ACTION_STATUS_FAILED` `ADDON_ACTION_STATUS_PENDING`.
- `type` (String) Тип действия над плагином. Возможные значения: `ADDON_ACTION_TYPE_DELETE` `ADDON_ACTION_TYPE_UNSPECIFIED` `ADDON_ACTION_TYPE_ADD` `ADDON_ACTION_TYPE_UPDATE`.

<a id="nestedatt--action_history--issues"></a>
### Nested Schema for `action_history.issues`

Read-Only:

- `code` (String) Код возможных проблем.
- `message` (String) Содержание проблемы.


<a id="nestedatt--action_history--params"></a>
### Nested Schema for `action_history.params`

Read-Only:

- `name` (String) Название параметра.
- `value` (String) Значение параметра.

## Импорт

Импорт может быть выполнен с помощью следующей команды:

```shell
terraform import cloudru_k8s_addon.nginx nginx,00000000000000000000000000
```

Import id это конкатенация поля `addon_name` и `cluster_id`, разделенных запятой.